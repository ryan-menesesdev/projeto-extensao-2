<header>

    <% 
        const cartQty = (typeof cart !== 'undefined' && Array.isArray(cart)) ? cart.reduce((acc, it) => acc + (parseInt(it.quantidade, 10) || 0), 0) : (typeof cartCount !== 'undefined' ? cartCount : 0);
    %>

    <div class="header-container">
        <a href="/" class="header-link" aria-label="Página Inicial de Sinhá Bolos e Lanches">
            <div class="header-left">
                <img src="/images/logo-better-nobackground.png" alt="Logo da Sinhá Bolos e Lanches" class="header-logo">
                <span class="header-logo-title">Sinhá Bolos e Lanches</span>
            </div>
        </a>
        <nav class="header-right" aria-label="Navegação principal">
            <div class="header-accessibility-container">
                <button id="header-accessibility-toggle-btn" class="header-dropdown" aria-label="Abrir menu de acessibilidade" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-universal-access" aria-hidden="true"></i>
                </button>
                <div id="header-accessibility-menu" class="header-accessibility-menu">
                    <div class="header-acessibility-content">
                        <label for="font-size-control" class="header-acessibility-label">Tamanho da Fonte</label>
                        <div id="font-size-control" class="header-acessibility-btn-container">
                            <button id="font-decrease-btn" class="header-acessibility-btn" aria-label="Diminuir fonte">A-</button>
                            <button id="font-reset-btn" class="header-acessibility-btn" aria-label="Resetar fonte">A</button>
                            <button id="font-increase-btn" class="header-acessibility-btn" aria-label="Aumentar fonte">A+</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="header-cart-container">
                <% if (user) { %>
                <a href="/cart" aria-label="Ver carrinho de compras">
                    <i class="fas fa-shopping-cart header-icon" aria-hidden="true"></i>
                    <span id="cart-counter" class="header-cart-count"><%= cartQty %></span>
                </a>
                <% } else { %>
                    <a href="#" role="menuitem" onclick="alert('Por favor, faça login antes!'); window.location.href='/login'; return false;">
                        <i class="fas fa-shopping-cart header-icon" aria-hidden="true"></i>
                        <span id="cart-counter" class="header-cart-count"><%= cartQty %></span>
                    </a>
                <% } %>
            </div>
            <div class="header-dropdown-container">
                <button class="header-dropdown" id="menuDropdownToggle" aria-haspopup="true" aria-expanded="false" aria-controls="menuDropdown">
                    Menu <i class="fas fa-chevron-down dropdown-arrow" aria-hidden="true"></i>
                </button>
                <div class="header-dropdown-menu" id="menuDropdown" role="menu">
                    <a href="/" role="menuitem" aria-current="page">Início</a>

                    <% if (user) { %>
                        <a href="/orders" role="menuitem" aria-current="page">Meus pedidos</a>
                    <% } else { %>
                        <a href="#" role="menuitem" onclick="alert('Por favor, faça login antes!'); window.location.href='/login'; return false;">
                            Meus pedidos
                        </a>
                    <% } %>
                    <a href="/about" role="menuitem">Sobre</a>
                    <a href="/contact" role="menuitem">Contato</a>
                    <a href="/team" role="menuitem">Equipe</a>
                    
                    <% if (user) { %>
                        <a href="/logout" role="menuitem">Sair</a>
                    <% } else { %>
                        <a href="/login" role="menuitem">Login</a>
                    <% } %>
                </div>
            </div>
        </nav>
    </div>
</header>