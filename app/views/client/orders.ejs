<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Conheça a equipe de desenvolvedores por trás do site da Sinhá Bolos e Lanches.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="icon" type="image/png" href="../assets/logo-better-nobackground.png">
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/back.css">
    <link rel="stylesheet" href="/css/orders.css"> 
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/header.css">
    <title>Meus pedidos - Sinhá Bolos e Lanches</title>
</head>
<body>
    <header>
        <div class="header-container">
            <a href="index.html" class="header-link" aria-label="Página Inicial de Sinhá Bolos e Lanches">
                <div class="header-left">
                    <img src="/images/logo-better-nobackground.png" alt="Logo da Sinhá Bolos e Lanches" class="header-logo">
                    <span class="header-logo-title">Sinhá Bolos e Lanches</span>
                </div>
            </a>
            <nav class="header-right" aria-label="Navegação principal">
                <div class="header-accessibility-container">
                    <button id="header-accessibility-toggle-btn" class="header-dropdown" aria-label="Abrir menu de acessibilidade" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-universal-access" aria-hidden="true"></i>
                    </button>
                    <div id="header-accessibility-menu" class="header-accessibility-menu">
                        <div class="header-acessibility-content">
                            <label for="font-size-control" class="header-acessibility-label">Tamanho da Fonte</label>
                            <div id="font-size-control" class="header-acessibility-btn-container">
                                <button id="font-decrease-btn" class="header-acessibility-btn" aria-label="Diminuir fonte">A-</button>
                                <button id="font-reset-btn" class="header-acessibility-btn" aria-label="Resetar fonte">A</button>
                                <button id="font-increase-btn" class="header-acessibility-btn" aria-label="Aumentar fonte">A+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="header-cart-container">
                    <a href="/cart" aria-label="Ver carrinho de compras">
                        <i class="fas fa-shopping-cart header-icon" aria-hidden="true"></i>
                        <span id="cart-counter" class="header-cart-count">0</span>
                    </a>
                </div>
                <div class="header-dropdown-container">
                    <button class="header-dropdown" id="menuDropdownToggle" aria-haspopup="true" aria-expanded="false" aria-controls="menuDropdown">
                        Menu <i class="fas fa-chevron-down dropdown-arrow" aria-hidden="true"></i>
                    </button>
                    <div class="header-dropdown-menu" id="menuDropdown" role="menu">
                        <a href="/" role="menuitem" aria-current="page">Início</a>
                        <a href="/orders" role="menuitem" aria-current="page">Meus pedidos</a>
                        <a href="/about" role="menuitem">Sobre</a>
                        <a href="/contact" role="menuitem">Contato</a>
                        <a href="/team" role="menuitem">Equipe</a>
                        <a href="#" id="auth-link-dropdown" role="menuitem">Sair</a>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <main>
            <div class="top-container">
                <a class="top-link" href="javascript:history.back()" aria-label="Voltar para a página inicial">
                    <i class="fas fa-arrow-left" aria-hidden="true"></i>
                    <span>Voltar</span>
                </a>
            </div>
            <section class="orders-section" aria-labelledby="orders-main-title">
            <h1 class="orders-section-title" id="orders-main-title">Meus pedidos</h1>
            
            <% if (orders && orders.length > 0) { %>
                <div class="orders-container" id="orders-list-container">
                    <% orders.forEach(order => {
                        const dataPedido = new Date(order.criadoEm).toLocaleDateString('pt-BR', {
                            day: '2-digit',
                            month: 'long',
                            year: 'numeric'
                        });
                        
                        // Calcula o valor total dos produtos do pedido
                        const valorTotal = order.products ? 
                            order.products.reduce((total, produto) => total + (produto.preco * produto.quantidade), 0) : 0;
                        
                        const statusClass = `status--${order.statusPedido.toLowerCase().replace(/\s+/g, '-')}`;
                    %>
                        <article class="order-card" aria-labelledby="order-id-<%= order.id %>">
                            <header class="order-card-header">
                                <h2 class="order-card-subtitle" id="order-id-<%= order.id %>">Pedido: #<%= String(order.id).toUpperCase() %></h2>
                                <p class="order-card-status <%= statusClass %>"><%= order.statusPedido %></p>
                            </header>

                            <div class="order-card-body">
                                <div class="order-card-details">
                                    <p class="order-card-text">
                                        <strong>Data:</strong> 
                                        <%= dataPedido %>
                                    </p>
                                    
                                    <p class="order-card-text">
                                        <strong>Valor Total:</strong> 
                                        <%= valorTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }) %>
                                    </p>
                                    
                                    <p class="order-card-text">
                                        <strong>Pagamento:</strong> 
                                        <%= order.metodoPagamento %>
                                    </p>
                                    
                                    <p class="order-card-text">
                                        <strong>Status do Pagamento:</strong> 
                                        <%= order.statusPagamento %>
                                    </p>
                                </div>

                                <% if (order.products && order.products.length > 0) { %>
                                    <div class="order-card-items">
                                        <h3 class="order-card-items-subtitle">Itens do Pedido:</h3>
                                        <ul class="order-card-items-list">
                                            <% order.products.forEach(produto => { %>
                                                <li class="order-card-items-item">
                                                    <%= produto.nome %> (x<%= produto.quantidade %>) - 
                                                    <%= (produto.preco * produto.quantidade).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }) %>
                                                </li>
                                            <% }); %>
                                        </ul>
                                    </div>
                                <% } %>
                            </div>
                        </article>
                    <% }); %>
                </div>
            <% } else { %>
                <div class="orders-container" id="orders-list-container">
                    <p>Você ainda não fez nenhum pedido.</p>
                </div>
            <% } %>
        </section>
        </div>
    </main>

    <footer>
        <div class="footer-container">
            <p class="footer-text">©2025 Sinhá Bolos e Lanches. Todos os direitos reservados.</p>
            <p class="footer-text">Horário de funcionamento: 10h - 18h</p>
            <nav aria-label="Navegação do rodapé">
                <p class="footer-text">
                    <a class="footer-link" href="/">Início</a> | 
                    <a class="footer-link" href="/about">Sobre</a> | 
                    <a class="footer-link" href="/contact">Contato</a> | 
                    <a class="footer-link" href="/team">Equipe</a>
                </p>
            </nav>
        </div>
    </footer>

    <script src="/js/utility.js" type="module"></script>
</body>
</html>