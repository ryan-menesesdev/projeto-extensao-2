<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Conheça a equipe de desenvolvedores por trás do site da Sinhá Bolos e Lanches.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="icon" type="image/png" href="../assets/logo-better-nobackground.png">
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/back.css">
    <link rel="stylesheet" href="/css/orders.css"> 
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/header.css">
    <title>Meus pedidos - Sinhá Bolos e Lanches</title>
</head>
<body>
    <%- include('../partials/header') %>

    <main>
            <div class="top-container">
                <a class="top-link" href="/" aria-label="Voltar para a página inicial">
                    <i class="fas fa-arrow-left" aria-hidden="true"></i>
                    <span>Voltar</span>
                </a>
            </div>
            <section class="orders-section" aria-labelledby="orders-main-title">
            <h1 class="orders-section-title" id="orders-main-title">Meus pedidos</h1>
            
            <% if (orders && orders.length > 0) { %>
                <div class="orders-container" id="orders-list-container">
                    <% orders.forEach(order => {
                        const dataPedido = new Date(order.criadoEm).toLocaleDateString('pt-BR', {
                            day: '2-digit',
                            month: 'long',
                            year: 'numeric'
                        });
                        
                        const valorTotal = order.products ? 
                            order.products.reduce((total, produto) => total + (produto.preco * produto.quantidade), 0) : 0;
                        
                        const statusClass = `status--${order.statusPedido.toLowerCase().replace(/\s+/g, '-')}`;
                    %>
                        <article class="order-card" aria-labelledby="order-id-<%= order.id %>">
                            <header class="order-card-header">
                                <a href="/orders/<%= order.id %>">
                                    <h2 class="order-card-subtitle" id="order-id-<%= order.id %>">Pedido: #<%= String(order.id).toUpperCase() %></h2>
                                </a>
                                <p class="order-card-status <%= statusClass %>"><%= order.statusPedido %></p>
                            </header>

                            <div class="order-card-body">
                                <div class="order-card-details">
                                    <p class="order-card-text">
                                        <strong>Data:</strong> 
                                        <%= dataPedido %>
                                    </p>
                                    
                                    <p class="order-card-text">
                                        <strong>Valor Total:</strong> 
                                        <%= valorTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }) %>
                                    </p>
                                    
                                    <p class="order-card-text">
                                        <strong>Pagamento:</strong> 
                                        <%= order.metodoPagamento %>
                                    </p>
                                    
                                    <p class="order-card-text">
                                        <strong>Status do Pagamento:</strong> 
                                        <%= order.statusPagamento %>
                                    </p>
                                </div>

                                <% if (order.products && order.products.length > 0) { %>
                                    <div class="order-card-items">
                                        <h3 class="order-card-items-subtitle">Itens do Pedido:</h3>
                                        <ul class="order-card-items-list">
                                            <% order.products.forEach(produto => { %>
                                                <li class="order-card-items-item">
                                                    <%= produto.nome %> (x<%= produto.quantidade %>) - 
                                                    <%= (produto.preco * produto.quantidade).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }) %>
                                                </li>
                                            <% }); %>
                                        </ul>
                                    </div>
                                <% } %>
                            </div>
                        </article>
                    <% }); %>
                </div>
            <% } else { %>
                <div class="orders-container" id="orders-list-container">
                    <p>Você ainda não fez nenhum pedido.</p>
                </div>
            <% } %>
        </section>
        </div>
    </main>

    <%- include('../partials/footer') %>

    <script src="/js/utility.js" type="module"></script>
</body>
</html>